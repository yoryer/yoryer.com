---
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import Contact from "@components/Contact.astro";
import SEO from "@components/SEO.astro";
import GoogleAnalytics from "@components/GoogleAnalytics.astro";
import "@styles/global.css";
import { useTranslations } from "@i18n/utils";

// Get both language translations
const enTranslations = useTranslations("en");
const esTranslations = useTranslations("es");

// Serialize translations for client-side use
const enTranslationsSerialized = JSON.parse(JSON.stringify(enTranslations));
const esTranslationsSerialized = JSON.parse(JSON.stringify(esTranslations));
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    
    <SEO 
      title="404 - Page Not Found"
      description="The page you're looking for doesn't exist"
      lang="en"
    />
    
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    
    <!-- Google Analytics -->
    {import.meta.env.PUBLIC_GA_MEASUREMENT_ID && (
      <GoogleAnalytics id={import.meta.env.PUBLIC_GA_MEASUREMENT_ID} />
    )}
    
    <!-- Dynamic Language Detection and Content Script -->
    <script is:inline define:vars={{ enTranslationsSerialized, esTranslationsSerialized }}>
      (function() {
        // Determine language from URL or browser
        let lang = 'en';
        let translations = enTranslationsSerialized;
        
        const path = window.location.pathname;
        
        // Check if URL indicates Spanish
        if (path.startsWith('/es/') || path === '/es') {
          lang = 'es';
          translations = esTranslationsSerialized;
        } else {
          // If not in Spanish path, check browser language
          const browserLang = navigator.language;
          if (browserLang && browserLang.toLowerCase().startsWith('es')) {
            lang = 'es';
            translations = esTranslationsSerialized;
          }
        }
        
        // Store for use in other scripts
        window.pageLang = lang;
        window.pageTranslations = translations;
        
        // Update HTML lang attribute
        document.documentElement.lang = lang;
        
        // Update page title
        document.title = `404 - ${translations.notFound.title}`;
      })();
    </script>
  </head>
  <body class="bg-blue bg-repeat text-white bg-[url('/img/bg.svg')] bg-cover">
    <div class="overflow-x-hidden">
      <!-- We'll need to make Header dynamic too, but for now it will show in English -->
      <Header />
      
      <!-- Main Content -->
      <main>
        <!-- 404 Content -->
        <section class="min-h-[60vh] flex items-center justify-center px-6 py-20">
          <div class="text-center">
            <!-- Big 404 Number -->
            <h1 class="text-[120px] sm:text-[160px] md:text-[200px] font-bold text-rose leading-none">
              404
            </h1>
            
            <!-- Message (dynamically updated) -->
            <p id="error-message" class="text-xl sm:text-2xl text-gray-300 mb-8 max-w-md mx-auto">
              <!-- Will be filled by JavaScript -->
            </p>
            
            <!-- Back to Home Button (dynamically updated) -->
            <a 
              id="home-link"
              href="/"
              class="inline-flex items-center gap-2 px-8 py-4 bg-rose text-white font-medium rounded-lg hover:bg-rose/90 transition-colors"
            >
              <svg 
                class="w-5 h-5" 
                fill="none" 
                stroke="currentColor" 
                viewBox="0 0 24 24"
              >
                <path 
                  stroke-linecap="round" 
                  stroke-linejoin="round" 
                  stroke-width="2" 
                  d="M10 19l-7-7m0 0l7-7m-7 7h18"
                />
              </svg>
              <span id="home-link-text"><!-- Will be filled by JavaScript --></span>
            </a>
          </div>
        </section>
        
        <!-- Contact Section -->
        <Contact />
      </main>
      
      <Footer />
    </div>
    
    <!-- Update content based on detected language -->
    <script is:inline>
      (function() {
        // Use the language and translations set in the head script
        const lang = window.pageLang || 'en';
        const translations = window.pageTranslations || {
          notFound: {
            message: "Oops! The page you're looking for doesn't exist.",
            backToHome: "Back to Homepage"
          }
        };
        
        // Update error message
        const errorMessage = document.getElementById('error-message');
        if (errorMessage) {
          errorMessage.textContent = translations.notFound.message;
        }
        
        // Update home link
        const homeLink = document.getElementById('home-link');
        const homeLinkText = document.getElementById('home-link-text');
        if (homeLink && homeLinkText) {
          homeLink.setAttribute('href', lang === 'es' ? '/es/' : '/');
          homeLinkText.textContent = translations.notFound.backToHome;
        }
        
        // Update navigation links if needed
        // This would require making the Header component dynamic as well
      })();
    </script>
  </body>
</html>